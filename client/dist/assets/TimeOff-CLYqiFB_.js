import{a as V,r as a,j as e}from"./index-D9hGhxv1.js";import{N as W}from"./Navbar-VGw1GWjM.js";import{C as T,a as w,B as l,d as D,I as N}from"./createLucideIcon-DPOfEtN0.js";const K="si_timeoff";function Y(s,r){try{const d=JSON.parse(s);return d??r}catch{return r}}function C(){if(typeof localStorage>"u")return[];const s=localStorage.getItem(K),r=s?Y(s,[]):[];return Array.isArray(r)?r:[]}function B(s){typeof localStorage>"u"||localStorage.setItem(K,JSON.stringify(s))}function X(s){const r=C(),d={id:s.id??`${Date.now()}_${Math.random().toString(16).slice(2)}`,employeeId:s.employeeId,employeeName:s.employeeName||"—",startDate:s.startDate,endDate:s.endDate,type:s.type||"paid",status:s.status||"pending",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},c=[d,...r];return B(c),d}function Z(s,r){const c=C().map(n=>n.id===s?{...n,status:r,updatedAt:new Date().toISOString()}:n);return B(c),c.find(n=>n.id===s)||null}function ee(s){try{const r=localStorage.getItem("si_employees"),d=r?JSON.parse(r):[],c=Array.isArray(d)?d:[],n=c.find(f=>f?.isCurrent);if(n)return n;if(s?.email)return c.find(f=>String(f?.email||"").toLowerCase()===String(s.email).toLowerCase())}catch{}return null}function _(s){if(!s)return"—";const r=new Date(s);return Number.isFinite(r.getTime())?r.toLocaleDateString([],{day:"2-digit",month:"2-digit",year:"numeric"}):String(s)}function ie(){const{user:s}=V(),r=(s?.role||"").toLowerCase()==="admin"||s?.isAdmin===!0,[d,c]=a.useState("timeOff"),[n,f]=a.useState("paid"),[y,k]=a.useState(""),[g,H]=a.useState(""),[J,A]=a.useState(0);function O(t){const i=String(t??"").trim();H(i),k("")}const[Q,j]=a.useState(!1),[o,v]=a.useState("paid"),[m,I]=a.useState(""),[u,R]=a.useState(""),[E,q]=a.useState(""),[S,h]=a.useState(!1),z=a.useMemo(()=>ee(s),[s]),p=z?.id??s?.id??s?.employeeId??null,F=z?.name||s?.name||s?.email||"—",L=a.useMemo(()=>C(),[J]),P=a.useMemo(()=>{const t=g.trim().toLowerCase();return L.filter(i=>n?i.type===n:!0).filter(i=>r?!0:String(i.employeeId)===String(p)).filter(i=>t?String(i.employeeName||"").toLowerCase().includes(t):!0)},[L,n,r,p,g]);function G(){h(!1),v(n),I(""),R(""),q(""),j(!0)}function M(t,i){Z(t,i),A(x=>x+1)}const b=a.useMemo(()=>{if(!m||!u)return 0;const t=new Date(`${m}T00:00:00`),i=new Date(`${u}T00:00:00`);if(!Number.isFinite(t.getTime())||!Number.isFinite(i.getTime()))return 0;const x=Math.floor((i.getTime()-t.getTime())/864e5);return x>=0?x+1:0},[m,u]),$=a.useMemo(()=>S?!p||!o||!m||!u||b<=0||o==="sick"&&!E:!1,[S,p,o,m,u,b,E]);function U(){if(h(!0),$)return;const t=new Date(`${m}T00:00:00`),i=new Date(`${u}T00:00:00`);X({employeeId:p,employeeName:F,startDate:t.toISOString(),endDate:i.toISOString(),type:o,status:"pending"}),j(!1),A(x=>x+1)}return e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsx(W,{}),e.jsxs("main",{className:"container mx-auto px-6 py-8",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1fr_420px]",children:[e.jsxs(T,{children:[e.jsx(w,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{size:"sm",variant:d==="timeOff"?"default":"ghost",onClick:()=>c("timeOff"),children:"Time Off"}),r&&e.jsx(l,{size:"sm",variant:d==="allocation"?"default":"ghost",onClick:()=>c("allocation"),children:"Allocation"})]})}),e.jsx(D,{children:r&&d==="allocation"?e.jsx("div",{className:"py-8 text-sm text-muted-foreground",children:"Allocation view coming soon."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{size:"sm",onClick:G,children:"NEW"}),e.jsx("div",{className:"w-64",children:e.jsx(N,{placeholder:g?`Search: ${g}`:"Search",value:y,onChange:t=>k(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),O(t.currentTarget.value))},onBlur:()=>{y!==""&&O(y)}})})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("button",{type:"button",className:n==="paid"?"font-medium underline":"text-muted-foreground",onClick:()=>f("paid"),children:"Paid time off"}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"24 Days Available"})]}),e.jsxs("div",{children:[e.jsx("button",{type:"button",className:n==="sick"?"font-medium underline":"text-muted-foreground",onClick:()=>f("sick"),children:"Sick time off"}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"07 Days Available"})]})]})]}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-2 text-left font-medium text-muted-foreground",children:"Name"}),e.jsx("th",{className:"py-2 text-left font-medium text-muted-foreground",children:"Start Date"}),e.jsx("th",{className:"py-2 text-left font-medium text-muted-foreground",children:"End Date"}),e.jsx("th",{className:"py-2 text-left font-medium text-muted-foreground",children:"Time off Type"}),e.jsx("th",{className:"py-2 text-left font-medium text-muted-foreground",children:"Status"}),r&&e.jsx("th",{className:"py-2 text-left font-medium text-muted-foreground",children:"Action"})]})}),e.jsx("tbody",{children:P.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:r?6:5,className:"py-8 text-center text-muted-foreground",children:"No time off records."})}):P.map(t=>e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"py-3",children:t.employeeName}),e.jsx("td",{className:"py-3",children:_(t.startDate)}),e.jsx("td",{className:"py-3",children:_(t.endDate)}),e.jsx("td",{className:"py-3",children:t.type==="sick"?"Sick time off":"Paid time off"}),e.jsx("td",{className:"py-3",children:t.status==="approved"?"Approved":t.status==="rejected"?"Rejected":"Pending"}),r&&e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>M(t.id,"rejected"),children:"Reject"}),e.jsx(l,{size:"sm",onClick:()=>M(t.id,"approved"),children:"Approve"})]})})]},t.id))})]})})]})})]}),r?e.jsxs(T,{children:[e.jsx(w,{className:"pb-3",children:e.jsx("div",{className:"text-lg font-semibold",children:"Note"})}),e.jsx(D,{children:e.jsx("div",{className:"rounded border border-dashed p-4 text-sm text-muted-foreground",children:"Employees can view only their own time off records, while Admins and HR Officers can view time off records & approve/reject them for all employees."})})]}):e.jsxs(T,{children:[e.jsx(w,{className:"pb-3",children:e.jsx("div",{className:"text-sm font-medium",children:"TimeOff Types:"})}),e.jsx(D,{className:"text-sm text-muted-foreground",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:"- Paid Time off"}),e.jsx("div",{children:"- Sick Leave"}),e.jsx("div",{children:"- Unpaid Leaves"})]})})]})]}),Q&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 p-4",children:e.jsxs("div",{className:"w-full max-w-xl rounded-lg border bg-background shadow",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[e.jsx("div",{className:"text-sm font-medium",children:"Time off Type Request"}),e.jsx("button",{type:"button",className:"text-sm text-muted-foreground","aria-label":"Close",onClick:()=>j(!1),children:"×"})]}),e.jsxs("div",{className:"grid gap-4 p-4 text-sm",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("div",{className:"text-muted-foreground",children:"Employee"}),e.jsx("div",{className:"font-medium",children:F})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("div",{className:"text-muted-foreground",children:"Time off Type"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{type:"button",variant:o==="paid"?"default":"outline",size:"sm",onClick:()=>v("paid"),children:"Paid time off"}),e.jsx(l,{type:"button",variant:o==="sick"?"default":"outline",size:"sm",onClick:()=>v("sick"),children:"Sick time off"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("div",{className:"text-muted-foreground",children:"Validity Period"}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"From"}),e.jsx(N,{type:"date",value:m,onChange:t=>{h(!0),I(t.target.value)}})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"To"}),e.jsx(N,{type:"date",value:u,onChange:t=>{h(!0),R(t.target.value)}})]})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("div",{className:"text-muted-foreground",children:"Allocation"}),e.jsxs("div",{className:"font-medium",children:[b.toFixed(2).padStart(5,"0")," Days"]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("div",{className:"text-muted-foreground",children:"Attachment"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{type:"file",onChange:t=>{h(!0);const i=t.target.files&&t.target.files[0];q(i?i.name:"")}}),o==="sick"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"(For sick leave certificate)"})]})]}),S&&$&&e.jsxs("div",{className:"rounded border border-destructive/30 bg-destructive/10 px-3 py-2 text-xs text-destructive",children:["Please fill all fields",o==="sick"?" and attach certificate":"","."]}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsx(l,{size:"sm",onClick:U,children:"Submit"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>j(!1),children:"Discard"})]})]})]})})]})]})}export{ie as default};
