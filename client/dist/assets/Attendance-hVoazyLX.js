import{a as P,r as a,j as e}from"./index-D9hGhxv1.js";import{g as p,l as _,f as k,a as b,N as q}from"./Navbar-VGw1GWjM.js";import{f as B,I as V,C as R,a as J,B as f,d as Q}from"./createLucideIcon-DPOfEtN0.js";const Y=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],G=B("chevron-down",Y);function S(n,c){const o=new Date(n);return o.setDate(o.getDate()+c),o}function M(n=new Date){const c=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0");return`${c}-${o}`}function U(n){try{const c=localStorage.getItem("si_employees"),o=c?JSON.parse(c):[],d=Array.isArray(o)?o:[],l=d.find(r=>r?.isCurrent);if(l)return l;if(n?.email)return d.find(r=>String(r?.email||"").toLowerCase()===String(n.email).toLowerCase())}catch{}return null}function X(n,c,o=5){const d=new Date(n,c+1,0).getDate();let l=0;for(let r=1;r<=d;r+=1){const N=new Date(n,c,r).getDay();o>=6?N!==0&&(l+=1):N!==0&&N!==6&&(l+=1)}return l}function ne(){const{user:n}=P(),[c,o]=a.useState("date"),[d,l]=a.useState(""),[r,N]=a.useState(""),[m,I]=a.useState(()=>p(new Date)),[u,$]=a.useState(()=>M(new Date)),[x,T]=a.useState(()=>p(new Date));function A(t){const s=String(t??"").trim();N(s),l("")}const D=a.useMemo(()=>_(),[n,m,u]),i=(n?.role||"").toLowerCase()==="admin"||n?.isAdmin===!0,L=a.useMemo(()=>U(n),[n]),y=L?.id??n?.id??n?.employeeId??null;L?.name||n?.name||n?.email;const E=a.useMemo(()=>{const t=r.trim().toLowerCase();return D.filter(s=>s.date===m).filter(s=>t?String(s.employeeName||"").toLowerCase().includes(t):!0).map(s=>{const h=Number(s.workedMs||0),g=Number(s.extraMs||0);return{...s,checkIn:b(s.checkInAt),checkOut:b(s.checkOutAt),workHours:k(h),extraHours:k(g)}})},[D,m,r]),w=a.useMemo(()=>{if(y==null)return[];const t=r.trim().toLowerCase();return D.filter(s=>String(s.employeeId)===String(y)).filter(s=>String(s.date||"").startsWith(u)).filter(s=>t?String(s.employeeName||"").toLowerCase().includes(t):!0).map(s=>{const h=Number(s.workedMs||0),g=Number(s.extraMs||0);return{...s,checkIn:b(s.checkInAt),checkOut:b(s.checkOutAt),workHours:k(h),extraHours:k(g)}}).sort((s,h)=>String(h.date).localeCompare(String(s.date)))},[D,y,u,r]),H=a.useMemo(()=>{const t=new Date(`${m}T00:00:00`);return Number.isFinite(t.getTime())?t.toLocaleDateString([],{day:"2-digit",month:"long",year:"numeric"}):m},[m]),K=a.useMemo(()=>{const t=new Date(`${u}-01T00:00:00`);return Number.isFinite(t.getTime())?t.toLocaleDateString([],{month:"short"}):u},[u]),O=a.useMemo(()=>{const t=new Date(`${x}T00:00:00`);return Number.isFinite(t.getTime())?t.toLocaleDateString([],{day:"2-digit",month:"long",year:"numeric"}):x},[x]);a.useEffect(()=>{if(i)return;const t=typeof document<"u"?document.getElementById(`att-row-${x}`):null;t&&typeof t.scrollIntoView=="function"&&t.scrollIntoView({block:"nearest"})},[i,x,w.length]);const C=a.useMemo(()=>{const t=new Date(`${u}-01T00:00:00`),s=t.getFullYear(),h=t.getMonth();let g=5;if(y!=null)try{const j=localStorage.getItem(`si_salary_${y}`),W=j?JSON.parse(j):null,v=Number(W?.workingDaysPerWeek);Number.isFinite(v)&&v>=1&&v<=7&&(g=v)}catch{}const F=X(s,h,g),z=w.filter(j=>Number(j.workedMs||0)>0||j.checkOutAt).length;return{totalWorkingDays:F,daysPresent:z,leavesCount:0}},[w,u,y]);return e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsx(q,{}),e.jsxs("main",{className:"container mx-auto px-6 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Attendance"}),e.jsx("div",{className:"w-64",children:e.jsx(V,{placeholder:r?`Search: ${r}`:"Search",value:d,onChange:t=>l(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),A(t.currentTarget.value))},onBlur:()=>{d!==""&&A(d)}})})]}),e.jsxs(R,{className:"mt-4",children:[e.jsx(J,{className:"pb-3",children:i?e.jsx("div",{className:"flex flex-wrap items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{variant:"outline",size:"icon","aria-label":"Previous day",onClick:()=>I(p(S(new Date(`${m}T00:00:00`),-1))),children:"←"}),e.jsx(f,{variant:"outline",size:"icon","aria-label":"Next day",onClick:()=>I(p(S(new Date(`${m}T00:00:00`),1))),children:"→"}),e.jsxs(f,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>o("date"),children:["Date ",e.jsx(G,{className:"h-4 w-4"})]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>o("day"),children:"Day"})]})}):e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{variant:"outline",size:"icon","aria-label":"Previous day",onClick:()=>{const t=p(S(new Date(`${x}T00:00:00`),-1));T(t),$(M(new Date(`${t}T00:00:00`)))},children:"←"}),e.jsx(f,{variant:"outline",size:"icon","aria-label":"Next day",onClick:()=>{const t=p(S(new Date(`${x}T00:00:00`),1));T(t),$(M(new Date(`${t}T00:00:00`)))},children:"→"})]}),e.jsx(f,{variant:"outline",size:"sm",children:K}),e.jsxs("div",{className:"flex flex-1 flex-wrap items-center justify-end gap-3",children:[e.jsxs("div",{className:"rounded border px-3 py-1 text-sm",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Count of days present"}),e.jsx("div",{className:"font-medium",children:C.daysPresent})]}),e.jsxs("div",{className:"rounded border px-3 py-1 text-sm",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Leaves count"}),e.jsx("div",{className:"font-medium",children:C.leavesCount})]}),e.jsxs("div",{className:"rounded border px-3 py-1 text-sm",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total working days"}),e.jsx("div",{className:"font-medium",children:C.totalWorkingDays})]})]})]})}),e.jsxs(Q,{children:[e.jsx("div",{className:"mb-4 text-sm text-muted-foreground",children:i?H:O}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[i?e.jsx("th",{className:"py-2 text-left font-medium text-muted-foreground",children:"Emp"}):e.jsx("th",{className:"py-2 text-left font-medium text-muted-foreground",children:"Date"}),e.jsx("th",{className:"py-2 text-left font-medium text-muted-foreground",children:"Check In"}),e.jsx("th",{className:"py-2 text-left font-medium text-muted-foreground",children:"Check Out"}),e.jsx("th",{className:"py-2 text-left font-medium text-muted-foreground",children:"Work Hours"}),e.jsx("th",{className:"py-2 text-left font-medium text-muted-foreground",children:"Extra hours"})]})}),e.jsx("tbody",{children:(i?E:w).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-8 text-center text-muted-foreground",children:"No attendance records for this date."})}):(i?E:w).map(t=>e.jsxs("tr",{id:i?void 0:`att-row-${t.date}`,className:`border-b last:border-b-0 ${!i&&t.date===x?"bg-muted/30":""}`,children:[i?e.jsx("td",{className:"py-3",children:t.employeeName}):e.jsx("td",{className:"py-3",children:t.date}),e.jsx("td",{className:"py-3",children:t.checkIn}),e.jsx("td",{className:"py-3",children:t.checkOut}),e.jsx("td",{className:"py-3",children:t.workHours}),e.jsx("td",{className:"py-3",children:t.extraHours})]},`${t.employeeId}-${t.date}`))})]})}),i&&c==="day"&&e.jsx("div",{className:"mt-4 text-xs text-muted-foreground",children:"Day view is currently the same as Date view."})]})]})]})]})}export{ne as default};
